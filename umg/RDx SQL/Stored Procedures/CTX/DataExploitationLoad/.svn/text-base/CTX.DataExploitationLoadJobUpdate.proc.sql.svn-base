-- =============================================
-- Author:		Valentin Kantchev
-- Create date: 05/20/2009
-- Description:	Reserves all extracted records (E) in CTX.LoadDataExploitation for Loading / Transformation (LT).
-- =============================================
CREATE PROCEDURE CTX.[DataExploitationLoadJobUpdate] 
AS
BEGIN
	UPDATE CTX.LoadDataExploitation
	SET WORKFLOW_CODE = 'C' 
	from CTX.LoadDataExploitation l 
		inner join CTX.LoadDataExploitationDriver ld 
			on l.CONTRACT_ID = ld.CONTRACT_ID 
				and l.RESTRICTIONS_CATEGORY = ld.RESTRICTIONS_CATEGORY
				and l.RESTRICTIONS_ITEM = ld.RESTRICTIONS_ITEM
	where 
		l.WORKFLOW_CODE = 'LT'
		and
		ld.WORKFLOW_CODE = 'T'
END
GO