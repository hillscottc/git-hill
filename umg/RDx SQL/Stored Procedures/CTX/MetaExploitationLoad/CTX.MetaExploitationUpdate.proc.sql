-- ============================================
-- Description:	Updates records in CTX.MetaExploitation
-- =============================================
CREATE PROCEDURE CTX.MetaExploitationUpdate 
AS
BEGIN
	update CTX.MetaExploitation
	set
		[ORGANIZATION_ID] = l.[ORGANIZATION_ID]
		,[TEMPLATE_ID] = l.[TEMPLATE_ID]
		,[TEMPLATE_NAME] = l.[TEMPLATE_NAME]
		,[RESTRICTIONS_CATEGORY] = l.[RESTRICTIONS_CATEGORY]
		,[RESTRICTIONS_ITEM] = l.[RESTRICTIONS_ITEM]

		,CHANGE_CODE = N'U'
		,CHANGE_DATE_TIME = getdate()
		,WORKFLOW_CODE = 'L'
	from 
		CTX.MetaExploitation t
		inner join CTX.LoadMetaExploitation l 
			on t.ORGANIZATION_ID = l.ORGANIZATION_ID 
				and t.TEMPLATE_ID = l.TEMPLATE_ID 
				and t.RESTRICTIONS_CATEGORY = l.RESTRICTIONS_CATEGORY
				and t.RESTRICTIONS_ITEM = l.RESTRICTIONS_ITEM
				
	-- update row counts		
	exec CTX.TransformLogTaskInsert 'CTX.MetaExploitation', @@rowcount, 'U'
END
GO